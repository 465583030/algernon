<!doctype html>
<html>
  <head>
    <title>Server Event</title>
    <script>

    if (!!window.EventSource) {
      var host = window.location.host;
      if (host.indexOf(':') >= 0) {
	host = host.split(':')[0]
      }
      var source = new EventSource('//' + host + ':5553/fs');
      source.addEventListener('message', function(e) {
	var l = window.location;
	//var base_url = l.protocol + "//" + l.host + "/" + l.pathname.split('/')[1];
	var full = '/' + e.data
	if (full.indexOf(l.pathname) >= 0) {
	  console.log(full)
  	  console.log(l.pathname)
	  console.log("yes, refresh!")
	} else {
	  console.log("no")
	}
      }, false);
      
      source.addEventListener('open', function(e) {
        // Connection was opened.
        console.log("Connection was opened!");
      }, false);
      
      source.addEventListener('error', function(e) {
        if (e.readyState == EventSource.CLOSED) {
          // Connection was closed.
          console.log("Connection was closed!");
        }
      }, false);
    
    }

    </script>
  </head>
  <body>
  hi there
  </body>
</html>
